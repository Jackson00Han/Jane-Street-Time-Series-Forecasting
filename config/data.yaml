# =========================
# Jane Street Global Configuration
# =========================

# Version and experiment root
exp_root: "exp/v1"

# --------- Reproducibility ---------
seed: 42

# -----------------------------
# I/O Configuration
# -----------------------------
io:
  backend: azure        # local | azure

blob:
  container: "jackson"
  prefix: "js_exp"

local:
  root: "/mnt/data/js"

paths:
  raw_root: "raw"

  raw_shards: "raw_shards"
  clean_shards: "clean_shards"
  fe_shards: "fe_shards"
  sample_fe: "sample_fe"
  panel_shards: "panel_shards"

  tft: "tft"

  fs_mm: "fs_mm"
  train_mm: "train_mm"

  models: "models"
  reports: "reports"
  cache: "cache"
  tmp: "tmp"

  fs_mm_prefix: "/mnt/data/js/exp/v1/fs_mm/full_sample_v1"
  feature_list_path: "/mnt/data/js/exp/v1/reports/fi/features__fs__1400-1698__cv2-g7-r4__seed42__top1000__1760906660.txt"
  train_mm_prefix: "/mnt/data/js/exp/v1/train_mm/full_train__features__fs__1400-1698__cv2-g7-r4__seed42__top1000__1760906660__range830-1698"

lgbm_selected_features_path: "/mnt/data/js/exp/v1/models/tune/feature_importance__fixed__fixed__mm_full_train__features__fs__1400-1698__cv2-g7-r4__seed42__top1000__1760906660__range830-1698__range830-1698__cv2-g7-r4__1760912739.csv"

keys: ["symbol_id", "date_id", "time_id"]
target: "responder_6"
weight: "weight"
sorts:
  time_major: ["date_id", "time_id", "symbol_id"]
time_bucket: "time_bucket"

# --------- Date ranges and splits ---------
dates:
  clean_dates:
    date_lo: 800
    date_hi: 1600

  fe_dates:
    date_lo: 800
    date_hi: 1698

  panel_dates:
    date_lo: 830
    date_hi: 1698

  mfs_dates:
    date_lo: 1400
    date_hi: 1698

  fs_dates:
    date_lo: 1400
    date_hi: 1698

  mtrain_dates:
    date_lo: 830
    date_hi: 1698

  tune_dates:
    date_lo: 830
    date_hi: 1698

cv:
  n_splits: 1
  gap_days: 0
  train_to_val: 2

# --------- Trading time parameters ---------
trading:
  ticks: 968
  bucket_size: 6

# --------- Missing value filling ---------
fill:
  open_tick_window: [0, 10]
  ttl_days_open: 7
  intra_ffill_max_gap_ticks: 200
  ttl_days_same_tick: 7
  order:
    - "open_ttl"
    - "intraday_ffill"
    - "same_tick_ttl"
    - "intraday_ffill"
  batch_size: 30

# --------- Winsorization / Outlier handling ---------
winsorization:
  method: "zscore"
  groupby: ["symbol_id", "time_bucket"]
  z_k: 3
  ddof: 1
  window: 480
  min_valid: 10
  cast_float32: true
  sanitize: true

feature_eng:
  A:
    enabled: true
    is_sorted: false
    cast_f32: true
    tail_lags: [1, 10, 50, 100, 500, 900, 950, 967]
    tail_diffs: [1, 5, 10, 30]
    rolling_windows: [3, 7, 14, 30]

  B:
    enabled: true
    lags: [1,2,3,4,5,6,7,14,21,30]
    is_sorted: false
    cast_f32: true
    stats_rep_cols: null
    add_prev1_multirep: true
    batch_size: 5

  C:
    enabled: true
    is_sorted: false
    cast_f32: true
    batch_size: 10
    lags: [1, 2, 10, 50, 100, 500, 900, 950, 968, 1936, 2904, 3872, 4840, 5808, 6776, 7744]
    ret_periods: [3, 10, 50]
    diff_periods: [3, 10, 50]
    rz_windows: [3, 7, 14, 30]
    ewm_spans: [5, 10, 50]
    keep_rmean_rstd: true
    cs_cols: ["feature_06", "feature_59", "feature_04", "feature_76", "feature_75", "feature_60", "feature_26"]

  fe_pad_days: 30
  fe_core_days: 30

lgb_select:
  device_type: gpu
  learning_rate: 0.05
  num_leaves: 63
  max_depth: 8
  feature_fraction: 0.80
  bagging_fraction: 0.80
  bagging_freq: 1
  min_data_in_leaf: 200
  num_boost_round: 4000
  early_stopping_rounds: 100
  log_period: 100 
  select_top_k: 1000

lgb+tune:
  device_type: cpu
  num_boost_round: 2000
  early_stopping_rounds: 100
  log_period: 100
  n_trials: 40

lgb_best:
  device_type: gpu
  num_boost_round: 4000
  early_stopping_rounds: 100
  log_period: 100
  final_boost_margin: 1.1
  num_leaves: 111
  max_depth: 12
  min_data_in_leaf: 1000
  learning_rate: 0.05394633936788147
  feature_fraction: 0.7390046601106091
  bagging_fraction: 0.7389986300840506
  bagging_freq: 1
  lambda_l2: 17.323522915498703
  lambda_l1: 3.005575058716044
  min_gain_to_split: 0.07080725777960455

white_list: ["time_pos", "time_sin", "time_cos", "time_bucket"]

debug:
  check_time_monotone: true

# --------- Reporting and audit ---------
